<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>המרת קישור גוגל לקואורדינטות ול-ITM</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
  <style>
    body { direction: rtl; font-family: sans-serif; margin: 2em; }
    input, button { font-size: 1em; padding: 0.5em; margin-top: 1em; width: 100%; }
    #output { margin-top: 2em; font-size: 1.2em; }
  </style>
</head>
<body>

  <h2>המרת קישור גוגל לקואורדינטות ול-ITM</h2>
  <label for="url">הדבק קישור מגוגל מפות:</label>
  <input type="text" id="url" placeholder="הדבק כאן קישור מגוגל מפות">
  <button onclick="convert()">המרה</button>

  <div id="output"></div>

  <script>
    proj4.defs("EPSG:4326", "+proj=longlat +datum=WGS84 +no_defs");
    proj4.defs("EPSG:2039", "+proj=tmerc +lat_0=31.73439361111111 +lon_0=35.20451694444445 +k=1.0000067 +x_0=219529.584 +y_0=626907.39 +ellps=GRS80 +units=m +no_defs");

    function extractLatLng(url) {
      try {
        let match = url.match(/@(-?\d+\.\d+),(-?\d+\.\d+)/);
        if (match) return { lat: parseFloat(match[1]), lng: parseFloat(match[2]) };

        match = url.match(/!3d(-?\d+\.\d+)!4d(-?\d+\.\d+)/);
        if (match) return { lat: parseFloat(match[1]), lng: parseFloat(match[2]) };

        return null;
      } catch {
        return null;
      }
    }

    function convert() {
      const url = document.getElementById("url").value;
      const coords = extractLatLng(url);
      const output = document.getElementById("output");

      if (!coords) {
        output.innerHTML = "לא נמצאו קואורדינטות תקינות בקישור.";
        return;
      }

      const { lat, lng } = coords;
      const [x, y] = proj4("EPSG:4326", "EPSG:2039", [lng, lat]);

      const govmapLink = `https://www.govmap.gov.il/?c=${x},${y}&z=10`;

      output.innerHTML = `
        <p><strong>Latitude (קו רוחב):</strong> ${lat}</p>
        <p><strong>Longitude (קו אורך):</strong> ${lng}</p>
        <p><strong>ITM X (מזרח):</strong> ${x.toFixed(2)}</p>
        <p><strong>ITM Y (צפון):</strong> ${y.toFixed(2)}</p>
        <p>לצפייה במיקום: <a href="${govmapLink}" target="_blank">govmap</a></p>
      `;
    }
  </script>

</body>
</html>
