<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>המרת קישור גוגל לקואורדינטות ול־ITM</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; direction: rtl; }
    label, input, button, p { font-size: 18px; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>המרת קישור גוגל לקואורדינטות ול־ITM</h1>
  <label for="googleUrl">הדבק קישור מגוגל מפות:</label>
  <input type="text" id="googleUrl" size="80" placeholder="https://www.google.com/maps...">
  <button onclick="convert()">המר</button>
  <div id="output"></div>

  <script>
    // הגדרת מערכת הקואורדינטות של ישראל - ITM (EPSG:2039)
    proj4.defs("EPSG:2039", "+proj=tmerc +lat_0=31.73439361111111 +lon_0=35.20451694444445 +k=1.0000067 +x_0=219529.584 +y_0=626907.39 +ellps=GRS80 +units=m +no_defs");

    function extractLatLng(url) {
      try {
        const atMatch = url.match(/@(-?\d+\.\d+),(-?\d+\.\d+)/);
        if (atMatch) return { lat: parseFloat(atMatch[1]), lng: parseFloat(atMatch[2]) };
        const dMatch = url.match(/!3d(-?\d+\.\d+)!4d(-?\d+\.\d+)/);
        if (dMatch) return { lat: parseFloat(dMatch[1]), lng: parseFloat(dMatch[2]) };
      } catch (e) {}
      return null;
    }

    function convert() {
      const url = document.getElementById('googleUrl').value;
      const coords = extractLatLng(url);
      const output = document.getElementById('output');
      if (!coords) {
        output.innerHTML = "<p style='color:red;'>לא נמצאו קואורדינטות תקינות בקישור.</p>";
        return;
      }

      const { lat, lng } = coords;
      const [x, y] = proj4('EPSG:4326', 'EPSG:2039', [lng, lat]);
      output.innerHTML = `
        <p><strong>Latitude (קו רוחב):</strong> ${lat}</p>
        <p><strong>Longitude (קו אורך):</strong> ${lng}</p>
        <p><strong>ITM X (מזרח):</strong> ${x.toFixed(2)}</p>
        <p><strong>ITM Y (צפון):</strong> ${y.toFixed(2)}</p>
        <p>להשוואה: ניתן להדביק קואורדינטות אלו באתר <a href="https://zvikabh.github.io/software/ITM/index_heb.html" target="_blank">צביקה בהט</a> לאימות</p>
      `;
    }
  </script>
</body>
</html>
