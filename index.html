<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>המרת קישור גוגל לקואורדינטות ול־ITM</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      text-align: center;
      padding: 30px;
    }
    input[type="text"] {
      width: 90%;
      padding: 10px;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
    }
    .output {
      margin-top: 30px;
      font-size: 18px;
    }
  </style>
</head>
<body>

<h2>המרת קישור גוגל לקואורדינטות ול־ITM</h2>
<p>הדבק קישור מגוגל מפות:</p>
<input type="text" id="mapUrl" placeholder="הדבק כאן קישור מגוגל מפות">
<br>
<button onclick="convert()">המר</button>

<div class="output" id="results"></div>

<script>
  const WGS84 = 'EPSG:4326';
  const ITM = '+proj=tmerc +lat_0=31.73439361111111 +lon_0=35.20451694444445 +k=1.0000067 ' +
              '+x_0=219529.584 +y_0=626907.39 +ellps=GRS80 +units=m +no_defs';

  function extractCoordinatesFromUrl(url) {
    try {
      // ניסיון למצוא את הקואורדינטות מכל סוג URL
      const latlonMatch = url.match(/@(-?\d+\.\d+),(-?\d+\.\d+)/) || url.match(/!3d(-?\d+\.\d+)!4d(-?\d+\.\d+)/);
      if (!latlonMatch) return null;
      const lat = parseFloat(latlonMatch[1]);
      const lon = parseFloat(latlonMatch[2]);
      return { lat, lon };
    } catch {
      return null;
    }
  }

  function convert() {
    const url = document.getElementById('mapUrl').value.trim();
    const coords = extractCoordinatesFromUrl(url);
    const output = document.getElementById('results');
    if (!coords) {
      output.innerHTML = '<span style="color:red;">לא נמצאו קואורדינטות בקישור.</span>';
      return;
    }

    const itm = proj4(WGS84, ITM, [coords.lon, coords.lat]);

    const lat = coords.lat.toFixed(7);
    const lon = coords.lon.toFixed(7);
    const itmX = itm[0].toFixed(2);
    const itmY = itm[1].toFixed(2);

    const govmapUrl = `https://www.govmap.gov.il/?c=${itmX},${itmY}&z=10`;

    output.innerHTML = `
      <strong>Latitude (קו רוחב):</strong> ${lat}<br>
      <strong>Longitude (קו אורך):</strong> ${lon}<br><br>
      <strong>ITM X (מזרח):</strong> ${itmX}<br>
      <strong>ITM Y (צפון):</strong> ${itmY}<br><br>
      <a href="${govmapUrl}" target="_blank">צפייה ב־govmap</a>
    `;
  }
</script>

</body>
</html>
